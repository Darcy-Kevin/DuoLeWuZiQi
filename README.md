# å¤šä¹äº”å­æ£‹åº”ç”¨ UI è‡ªåŠ¨åŒ–æµ‹è¯•é¡¹ç›®

## é¡¹ç›®ç®€ä»‹
æœ¬ä»“åº“æä¾›å¤šä¹äº”å­æ£‹ï¼ˆåŒ…å `com.duole.wuziqihd`ï¼‰çš„ç§»åŠ¨ç«¯ UI è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬ï¼ŒåŸºäº `uiautomator2`ã€`pytest` ä¸ Allure æŠ¥å‘Šä½“ç³»æ„å»ºã€‚æµ‹è¯•ç”¨ä¾‹è¦†ç›–æ¸¸æˆå¯åŠ¨ã€é‚®ä»¶çº¢ç‚¹ã€æ¯æ—¥ç­¾åˆ°ç­‰å…³é”®ä¸šåŠ¡æµç¨‹ï¼Œå¹¶ç»“åˆå›¾åƒè¯†åˆ«èƒ½åŠ›éªŒè¯ç•Œé¢å…ƒç´ ï¼Œé€‚ç”¨äº Android è®¾å¤‡çš„å›å½’æµ‹è¯•ä¸å†’çƒŸæ£€æŸ¥ã€‚

## åŠŸèƒ½äº®ç‚¹
- **è®¾å¤‡é©±åŠ¨è‡ªåŠ¨ç®¡ç†**ï¼šé€šè¿‡ `uiautomator2` å¿«é€Ÿè¿æ¥çœŸæœºæˆ–æ¨¡æ‹Ÿå™¨ï¼Œè„šæœ¬è‡ªåŠ¨åˆå§‹åŒ–æœåŠ¡ã€‚
- **å¤šåœºæ™¯å›¾åƒè¯†åˆ«**ï¼šåˆ©ç”¨ OpenCV æ¨¡æ¿åŒ¹é…å®šä½æŒ‰é’®ã€çº¢ç‚¹ã€æ ‡é¢˜ç­‰è§†è§‰å…ƒç´ ï¼Œæ”¯æŒè‡ªå®šä¹‰æ¨¡æ¿ç”Ÿæˆå·¥å…·ã€‚
- **API + UI è”åŠ¨éªŒè¯**ï¼šåœ¨é‚®ä»¶çº¢ç‚¹ç”¨ä¾‹ä¸­ç»“åˆæ¥å£é€ æ•°ä¸ç•Œé¢æ ¡éªŒï¼Œç¡®ä¿ç«¯åˆ°ç«¯é€»è¾‘é—­ç¯ã€‚
- **Allure æŠ¥å‘Šé›†æˆ**ï¼šæµ‹è¯•æ‰§è¡Œåè‡ªåŠ¨äº§å‡ºç»“æ„åŒ–æŠ¥å‘Šï¼Œé™„å¸¦æˆªå›¾ã€æ ‡è®°å›¾åŠè°ƒè¯•ä¿¡æ¯ã€‚
- **è„šæœ¬åŒ–æµç¨‹**ï¼šæä¾›ä¸€é”®ç¯å¢ƒé…ç½®ã€æ‰¹é‡/å•ä¾‹è¿è¡Œã€æˆªå›¾æ¸…ç†ç­‰è¾…åŠ©è„šæœ¬ï¼Œé™ä½ä¸Šæ‰‹é—¨æ§›ã€‚

## ç›®å½•ç»“æ„
```
DuoLeWuZiQi/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/                     # åæ ‡ä¸åŒ…åé…ç½®ï¼ˆæŒ‰æ¨¡å—å°è£…ï¼‰
â”‚   â”œâ”€â”€ resources/
â”‚   â”‚   â”œâ”€â”€ screenshots/            # æµ‹è¯•è¿è¡Œæ—¶ç”Ÿæˆçš„æˆªå›¾ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
â”‚   â”‚   â””â”€â”€ templates/              # å›¾åƒæ¨¡æ¿èµ„æºï¼ˆcommon/mi ç­‰å­ç›®å½•ï¼‰
â”‚   â”œâ”€â”€ tests/
â”‚   â”‚   â”œâ”€â”€ app_launch/             # å¯åŠ¨å†’çƒŸç”¨ä¾‹
â”‚   â”‚   â”œâ”€â”€ app_email/              # é‚®ä»¶çº¢ç‚¹/é€€åœºç”¨ä¾‹
â”‚   â”‚   â””â”€â”€ app_signin/             # æ¯æ—¥ç­¾åˆ°ç”¨ä¾‹
â”‚   â””â”€â”€ utils/                      # æˆªå›¾ã€æ—¶é—´ã€æ»‘åŠ¨ã€å›¾åƒåŒ¹é…ç­‰å·¥å…·åº“
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ run/                        # è¿è¡Œç”¨ä¾‹è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ run_tests.sh            # æ‰¹é‡æ‰§è¡Œæ‰€æœ‰æµ‹è¯•
â”‚   â”‚   â””â”€â”€ run_single_test.sh      # å•ä¸ª/ç­›é€‰ç”¨ä¾‹æ‰§è¡Œè„šæœ¬
â”‚   â”œâ”€â”€ report/                     # æŠ¥å‘Šç›¸å…³è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ stop_report_server.sh   # åœæ­¢æŠ¥å‘ŠæœåŠ¡å™¨
â”‚   â”‚   â””â”€â”€ cleanup_report_servers.sh  # æ¸…ç†æŠ¥å‘ŠæœåŠ¡å™¨
â”‚   â””â”€â”€ setup.sh                    # ç¯å¢ƒåˆå§‹åŒ–è„šæœ¬
â”œâ”€â”€ tools/                          # å·¥å…·è„šæœ¬
â”‚   â”œâ”€â”€ create_template_common.py   # æ¨¡æ¿ç”Ÿæˆè¾…åŠ©è„šæœ¬
â”‚   â”œâ”€â”€ email_request.sh            # é‚®ä»¶é€ æ•° curl è„šæœ¬
â”‚   â””â”€â”€ email_request_for_python.py # é‚®ä»¶é€ æ•° Python ç¤ºä¾‹
â”œâ”€â”€ allure-results/                 # pytest --alluredir è¾“å‡ºç›®å½•
â”œâ”€â”€ allure-report/                  # allure generate/serve è¾“å‡ºç›®å½•
â”œâ”€â”€ artifacts/                      # ç”¨ä¾‹äº§ç‰©è¾“å‡ºï¼ˆæµç¨‹å›¾é¢„è§ˆã€è¯´æ˜æ–‡æ¡£ç­‰ï¼‰
â”œâ”€â”€ venv/                           # é¡¹ç›®è™šæ‹Ÿç¯å¢ƒï¼ˆç”± scripts/setup.sh åˆ›å»ºï¼‰
â”œâ”€â”€ requirements.txt                # Python ä¾èµ–æ¸…å•
â””â”€â”€ README.md                       # é¡¹ç›®è¯´æ˜æ–‡æ¡£
```

## ç¯å¢ƒè¦æ±‚
- macOS æˆ– Linuxï¼ˆWindows éœ€è‡ªè¡Œè°ƒæ•´ Shell è„šæœ¬ï¼‰
- Python 3.9 åŠä»¥ä¸Š
- ADBï¼ˆAndroid Platform Toolsï¼‰ï¼Œå¹¶ä¿è¯ `adb devices` èƒ½è¯†åˆ«ç›®æ ‡è®¾å¤‡
- å·²å¯ç”¨å¼€å‘è€…æ¨¡å¼ & USB è°ƒè¯•çš„ Android è®¾å¤‡æˆ–æ¨¡æ‹Ÿå™¨
- Homebrew æˆ– npmï¼ˆç”¨äºå®‰è£… Allure CLIï¼Œå¯é€‰ä½†æ¨èï¼‰
- ç½‘ç»œå¯è®¿é—®é‚®ä»¶æ¥å£æœåŠ¡ `http://120.53.247.249:8012`

> æç¤ºï¼šé¡¹ç›®è‡ªå¸¦ `venv/` ç›®å½•ï¼Œå¦‚éœ€é‡æ–°åˆ›å»ºå¯åˆ é™¤è¯¥ç›®å½•åé‡æ–°æ‰§è¡Œ `./scripts/setup.sh`ã€‚

## å¿«é€Ÿå¼€å§‹
```bash
# 1. èµ‹äºˆè„šæœ¬æ‰§è¡Œæƒé™ï¼ˆé¦–æ¬¡å…‹éš†åå»ºè®®æ‰§è¡Œï¼‰
chmod +x scripts/**/*.sh scripts/*.sh tools/*.py tools/*.sh

# 2. ä¸€é”®åˆå§‹åŒ–è™šæ‹Ÿç¯å¢ƒä¸ä¾èµ–
./scripts/setup.sh

# 3. è¿æ¥ Android è®¾å¤‡å¹¶ç¡®è®¤ ADB æ­£å¸¸
adb devices

# 4. è¿è¡Œå…¨é‡ UI æµ‹è¯•
./scripts/run/run_tests.sh
```

æ‰§è¡Œå®Œæˆåï¼š
- Allure åŸå§‹ç»“æœä¿å­˜åœ¨ `allure-results/`
- è‹¥æœ¬æœºå®‰è£…äº† Allure CLIï¼Œè„šæœ¬ä¼šè‡ªåŠ¨å¯åŠ¨ `allure serve allure-results`

## è¿è¡Œæ–¹å¼è¯¦è§£
- **å…¨é‡å›å½’**ï¼š`./scripts/run/run_tests.sh`
  - è‡ªåŠ¨æ¸…ç†æ—§æˆªå›¾/ç¼“å­˜
  - åˆå§‹åŒ– `uiautomator2` æœåŠ¡
  - é»˜è®¤æ‰§è¡Œ `src/tests/app_email/app_email_test.py`
  - æ”¯æŒæ£€æµ‹å¹¶é€‰å–é¦–å°åœ¨çº¿è®¾å¤‡ï¼ˆå¯é€šè¿‡ `ANDROID_SERIAL` æŒ‡å®šï¼‰
- **å•ç”¨ä¾‹æ‰§è¡Œ**ï¼š`./scripts/run/run_single_test.sh <pytest é€‰æ‹©å™¨>`
  - ç¤ºä¾‹ï¼š`./scripts/run/run_single_test.sh src/tests/app_launch/app_launch_test.py::TestDuoleWuZiQiApp::test_launch_app`
  - æ”¯æŒä¼ å…¥ `-k`ã€`-m` ç­‰åŸç”Ÿ pytest å‚æ•°
- **åœæ­¢æŠ¥å‘ŠæœåŠ¡å™¨**ï¼š`./scripts/report/stop_report_server.sh`
- **æ¸…ç†æŠ¥å‘ŠæœåŠ¡å™¨**ï¼š`./scripts/report/cleanup_report_servers.sh`
- **æ‰‹åŠ¨æ‰§è¡Œ**ï¼š
  ```bash
  source venv/bin/activate
  adb devices  # ç¡®ä¿è®¾å¤‡åœ¨çº¿
  ANDROID_SERIAL=<è®¾å¤‡åºåˆ—å·> \
    pytest src/tests/app_email/app_email_test.py --alluredir=allure-results -v
  ```

## æµ‹è¯•åœºæ™¯æ¦‚è§ˆ
- `app_launch_test.py`ï¼šéªŒè¯åº”ç”¨å¯åŠ¨æˆåŠŸã€åŒ…ååŒ¹é…ã€‚
- `app_email_test.py`ï¼š
  - å¯åŠ¨å¹¶æ ¡éªŒè¿›å…¥å¤§å…ï¼ˆåŸºäºå¤šç»„å›¾åƒæ¨¡æ¿ï¼‰
  - é€šè¿‡æ¥å£è§¦å‘é‚®ä»¶çº¢ç‚¹ï¼ŒéªŒè¯çº¢ç‚¹å±•ç¤º â†’ é‚®ä»¶è¯¦æƒ… â†’ è¿”å›å¤§å…çº¢ç‚¹æ¶ˆå¤±çš„æ­£å‘é“¾è·¯
  - å…¨æµç¨‹åŒ…å«å¼‚å¸¸å…œåº•ä¸é™æ—¶ç­‰å¾…é€»è¾‘
- `app_signin_test.py`ï¼š
  - è§¦å‘ç­¾åˆ°å…¥å£çº¢ç‚¹
  - ç‚¹å‡»ç­¾åˆ°æŒ‰é’®å¹¶éªŒè¯ç­¾åˆ°å¼¹çª—
  - ä½¿ç”¨è„šæœ¬ `email_request.sh` è¿›è¡Œé€ æ•°æ”¯æŒ

æ›´å¤šç»†èŠ‚ä¸æµç¨‹å¯å‚è€ƒ `app_email_test_flowchart.md` åŠ `artifacts/preview_markdown.html` ä¸­çš„ Mermaid æµç¨‹å›¾ã€‚

## å·¥å…·è„šæœ¬ä¸è¾…åŠ©èµ„æº
- `artifacts/`ï¼šé›†ä¸­å­˜æ”¾ç”¨ä¾‹ç›¸å…³äº§ç‰©ï¼Œä¾‹å¦‚ `preview_markdown.html`ï¼ˆé‚®ä»¶ç”¨ä¾‹æµç¨‹å›¾ HTML é¢„è§ˆï¼‰ï¼Œä¾¿äºæµè§ˆå™¨ç›´æ¥æŸ¥çœ‹ã€‚
- `tools/create_template_common.py`ï¼šäº¤äº’å¼æ¨¡æ¿ç”Ÿæˆå™¨ï¼Œæˆªå–æŒ‡å®šåæ ‡çš„æˆªå›¾ç‰‡æ®µå¹¶ä¿å­˜ä¸º `*_common.png`ï¼Œä¾¿äºæ‰©å±•å›¾åƒè¯†åˆ«è¦†ç›–é¢ã€‚
- `tools/email_request.sh` ä¸ `tools/email_request_for_python.py`ï¼šå¿«é€Ÿè°ƒç”¨åå°é‚®ä»¶æ¥å£ï¼Œæ”¯æ’‘é‚®ä»¶çº¢ç‚¹ã€ç­¾åˆ°çº¢ç‚¹ç­‰åœºæ™¯çš„å‰ç½®æ•°æ®å‡†å¤‡ã€‚
- `src/utils/` ä¸‹æä¾›çš„é€šç”¨èƒ½åŠ›ï¼š
  - `image_utils.py`ï¼šOpenCV æ¨¡æ¿åŒ¹é…ã€åœˆé€‰ã€æ‰¹é‡åŒ¹é…ç­‰æ–¹æ³•
  - `screenshot_utils.py`ï¼šç»Ÿä¸€çš„æˆªå›¾å‘½åã€Allure é™„ä»¶å·¥å…·
  - `scroll_utils.py`ï¼šå¸¸è§ä¸Šä¸‹/å·¦å³æ»‘åŠ¨ä¸éå†æŸ¥æ‰¾å°è£…
  - `time_utils.py`ï¼šæ—¶é—´æˆ³æ ¼å¼åŒ–å·¥å…·
- `src/config/coordinates.py`ï¼šæŒ‰åŒ…åç»„ç»‡çš„èµ„æº ID æ˜ å°„ï¼Œå¯é€šè¿‡ `set_current_app` åŠ¨æ€åˆ‡æ¢ç›®æ ‡åŒ…ã€‚
- `scripts/report/`ï¼šæŠ¥å‘ŠæœåŠ¡å™¨ç®¡ç†è„šæœ¬
  - `stop_report_server.sh`ï¼šåœæ­¢å•ä¸ªæŠ¥å‘ŠæœåŠ¡å™¨
  - `cleanup_report_servers.sh`ï¼šæ¸…ç†æ‰€æœ‰æŠ¥å‘ŠæœåŠ¡å™¨è¿›ç¨‹

## Allure æŠ¥å‘Š
1. ç¡®è®¤å·²å®‰è£… CLIï¼ˆä»»é€‰å…¶ä¸€ï¼‰ï¼š
   - `brew install allure`
   - `npm install -g allure-commandline`
2. ç”Ÿæˆ/æŸ¥çœ‹æŠ¥å‘Šï¼š
   ```bash
   allure serve allure-results
   # æˆ–
   allure generate allure-results --clean -o allure-report
   ```
3. æµ‹è¯•è„šæœ¬åœ¨å…³é”®æ­¥éª¤ä¼šé™„åŠ åŸå§‹æˆªå›¾åŠå¸¦åœˆé€‰çš„æ¯”å¯¹å›¾ï¼Œä¾¿äºæº¯æºé—®é¢˜ã€‚

## å¸¸è§é—®é¢˜æ’æŸ¥
- **è®¾å¤‡æ— æ³•è¯†åˆ«**ï¼šç¡®è®¤ USB è°ƒè¯•å·²å¼€å¯ï¼Œæ‰§è¡Œ `adb kill-server && adb start-server` åé‡è¯•ã€‚
- **uiautomator2 åˆå§‹åŒ–å¤±è´¥**ï¼šæ‰§è¡Œ `venv/bin/python -m uiautomator2 init` å¹¶ç•™æ„æ§åˆ¶å°è¾“å‡ºã€‚
- **æ¨¡æ¿åŒ¹é…å¤±è´¥**ï¼šæ£€æŸ¥ `src/resources/templates` æ˜¯å¦å­˜åœ¨å¯¹åº”æ¨¡æ¿ï¼Œå¯ä½¿ç”¨æ¨¡æ¿ç”Ÿæˆå™¨é‡æ–°æå–ã€‚
- **é‚®ä»¶æ¥å£è¯·æ±‚å¤±è´¥**ï¼šç¡®è®¤ç½‘ç»œå¯è¾¾æ€§ä¸è´¦å·æƒé™ï¼ŒæŸ¥çœ‹ Allure æŠ¥å‘Šä¸­çš„æ¥å£å“åº”æ–‡æœ¬ã€‚

## è´¡çŒ®è¯´æ˜
1. æ–°å¢å›¾åƒæ¨¡æ¿æ—¶ï¼Œè¯·ä¿æŒæ¸…æ™°å‘½åå¹¶æ”¾å…¥å¯¹åº”ä¸šåŠ¡ç›®å½•ï¼ˆä¾‹å¦‚ `gamehome_button/`ï¼‰ã€‚
2. å¦‚éœ€æ‰©å±•é…ç½®é¡¹ï¼Œåœ¨ `src/config/coordinates.py` ä¸­æŒ‰æ¨¡å—è¡¥å……å¹¶æ›´æ–°å¯¹åº”å·¥å…·ç±»ã€‚
3. ä¿®æ”¹æˆ–æ–°å¢ç”¨ä¾‹åï¼Œç¡®ä¿æœ¬åœ°æ‰§è¡Œ Allure æŠ¥å‘Šå¹¶æ£€æŸ¥æˆªå›¾æ˜¯å¦æ­£ç¡®é™„åŠ ã€‚

---
å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿æäº¤ Issue / PR å…±åŒå®Œå–„æµ‹è¯•ä½“ç³»ã€‚ç¥æµ‹è¯•é¡ºåˆ© ğŸ¯
